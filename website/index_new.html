<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Built Signal - Construction & Real Estate Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(0 0% 0%)',
                        foreground: 'hsl(0 0% 98%)',
                        card: 'hsl(0 0% 0%)',
                        'card-foreground': 'hsl(0 0% 98%)',
                        popover: 'hsl(0 0% 5%)',
                        'popover-foreground': 'hsl(0 0% 98%)',
                        primary: 'hsl(0 0% 98%)',
                        'primary-foreground': 'hsl(0 0% 9%)',
                        secondary: 'hsl(0 0% 14%)',
                        'secondary-foreground': 'hsl(0 0% 98%)',
                        muted: 'hsl(0 0% 14%)',
                        'muted-foreground': 'hsl(0 0% 60%)',
                        accent: 'hsl(217 91% 60%)',
                        'accent-foreground': 'hsl(0 0% 98%)',
                        destructive: 'hsl(0 63% 50%)',
                        'destructive-foreground': 'hsl(0 0% 98%)',
                        border: 'hsl(0 0% 14%)',
                        input: 'hsl(0 0% 14%)',
                        ring: 'hsl(0 0% 83%)',
                    },
                    borderRadius: {
                        lg: '0.75rem',
                        md: '0.5rem',
                        sm: '0.375rem',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'spin': 'spin 1s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, hsl(217 91% 60%) 0%, hsl(217 91% 50%) 100%);
        }
        
        .gradient-accent {
            background: linear-gradient(135deg, hsl(25 95% 53%) 0%, hsl(25 95% 43%) 100%);
        }
        
        .shadow-sm {
            box-shadow: 0 1px 2px 0 hsl(0 0% 0% / 0.3);
        }
        
        .shadow-md {
            box-shadow: 0 4px 6px -1px hsl(0 0% 0% / 0.4), 0 2px 4px -1px hsl(0 0% 0% / 0.3);
        }
        
        .shadow-lg {
            box-shadow: 0 10px 15px -3px hsl(0 0% 0% / 0.5), 0 4px 6px -2px hsl(0 0% 0% / 0.4);
        }
    </style>
</head>
<body class="min-h-screen bg-background text-foreground">
    <!-- TopBar -->
    <header class="sticky top-0 z-10 bg-background border-b border-border">
        <div class="w-full px-4 py-3">
            <div class="relative flex items-center justify-between">
                <button 
                    onclick="showHome()"
                    class="flex items-center gap-2 hover:opacity-80 transition-opacity"
                >
                    <svg class="h-6 w-6 text-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                    <h1 class="text-xl font-bold text-foreground">
                        Built Signal
                    </h1>
                </button>
                
                <div class="absolute left-1/2 -translate-x-1/2 flex items-center gap-6">
                    <button onclick="showHome()" class="text-sm transition-colors whitespace-nowrap text-foreground font-medium">
                        All
                    </button>
                    <button onclick="showTheme('opportunities')" class="text-sm transition-colors whitespace-nowrap text-muted-foreground hover:text-foreground">
                        Opportunities
                    </button>
                    <button onclick="showTheme('practices')" class="text-sm transition-colors whitespace-nowrap text-muted-foreground hover:text-foreground">
                        Practices
                    </button>
                    <button onclick="showTheme('systems')" class="text-sm transition-colors whitespace-nowrap text-muted-foreground hover:text-foreground">
                        Systems
                    </button>
                    <button onclick="showTheme('vision')" class="text-sm transition-colors whitespace-nowrap text-muted-foreground hover:text-foreground">
                        Vision
                    </button>
                </div>

                <button
                    onclick="refreshArticles()"
                    class="h-8 w-8 flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent hover:text-accent-foreground"
                >
                    <svg id="refresh-icon" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Home Page -->
        <div id="home-page">
            <!-- Loading State -->
            <div id="loading" class="space-y-12 hidden">
                <div>
                    <div class="h-8 w-48 mb-6 bg-muted animate-pulse rounded"></div>
                    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                        <div class="bg-card rounded-xl overflow-hidden border border-border shadow-sm">
                            <div class="w-full aspect-[4/3] bg-muted animate-pulse"></div>
                            <div class="p-6 space-y-3">
                                <div class="h-6 w-3/4 bg-muted animate-pulse rounded"></div>
                                <div class="h-4 w-full bg-muted animate-pulse rounded"></div>
                                <div class="h-20 w-full bg-muted animate-pulse rounded"></div>
                            </div>
                        </div>
                        <div class="bg-card rounded-xl overflow-hidden border border-border shadow-sm">
                            <div class="w-full aspect-[4/3] bg-muted animate-pulse"></div>
                            <div class="p-6 space-y-3">
                                <div class="h-6 w-3/4 bg-muted animate-pulse rounded"></div>
                                <div class="h-4 w-full bg-muted animate-pulse rounded"></div>
                                <div class="h-20 w-full bg-muted animate-pulse rounded"></div>
                            </div>
                        </div>
                        <div class="bg-card rounded-xl overflow-hidden border border-border shadow-sm">
                            <div class="w-full aspect-[4/3] bg-muted animate-pulse"></div>
                            <div class="p-6 space-y-3">
                                <div class="h-6 w-3/4 bg-muted animate-pulse rounded"></div>
                                <div class="h-4 w-full bg-muted animate-pulse rounded"></div>
                                <div class="h-20 w-full bg-muted animate-pulse rounded"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error State -->
            <div id="error" class="flex flex-col items-center justify-center py-12 text-center hidden">
                <svg class="h-12 w-12 text-destructive mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
                </svg>
                <h2 class="text-xl font-semibold mb-2">Failed to load articles</h2>
                <p class="text-muted-foreground mb-4">Check back later for new stories</p>
                <button onclick="loadHomePage()" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:opacity-90 transition-opacity">
                    Try again
                </button>
            </div>

            <!-- Content -->
            <div id="content" class="space-y-16"></div>
        </div>

        <!-- Theme Page -->
        <div id="theme-page" class="hidden">
            <div class="mb-8">
                <h1 id="theme-title" class="text-3xl font-bold mb-2"></h1>
                <p id="theme-description" class="text-muted-foreground"></p>
            </div>

            <!-- Theme Loading -->
            <div id="theme-loading" class="space-y-12 hidden">
                <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    <div class="bg-card rounded-xl overflow-hidden border border-border shadow-sm">
                        <div class="w-full aspect-[4/3] bg-muted animate-pulse"></div>
                        <div class="p-6 space-y-3">
                            <div class="h-6 w-3/4 bg-muted animate-pulse rounded"></div>
                            <div class="h-4 w-full bg-muted animate-pulse rounded"></div>
                            <div class="h-20 w-full bg-muted animate-pulse rounded"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Theme Error -->
            <div id="theme-error" class="flex flex-col items-center justify-center py-12 text-center hidden">
                <svg class="h-12 w-12 text-destructive mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
                </svg>
                <h2 class="text-xl font-semibold mb-2">No articles available</h2>
                <p class="text-muted-foreground">Check back later for new stories</p>
            </div>

            <!-- Articles Grid -->
            <div id="articles-grid" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></div>
        </div>
    </main>

    <script>
        // API Configuration
        const API_BASE = 'https://newsletter-api-v2.onrender.com';
        
        let currentPage = 'home';
        let currentTheme = null;
        let allArticles = [];

        // Navigation functions
        function showHome() {
            currentPage = 'home';
            document.getElementById('home-page').classList.remove('hidden');
            document.getElementById('theme-page').classList.add('hidden');
            loadHomePage();
        }

        function showTheme(themeName) {
            currentPage = 'theme';
            currentTheme = themeName;
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('theme-page').classList.remove('hidden');
            loadThemePage(themeName);
        }

        // Utility functions
        function showLoading(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function hideLoading(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function showError(id, message = '') {
            const element = document.getElementById(id);
            element.classList.remove('hidden');
            if (message && element.querySelector('p')) {
                element.querySelector('p').textContent = message;
            }
        }

        function hideError(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function showContent(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function hideContent(id) {
            document.getElementById(id).classList.add('hidden');
        }

        // Load home page
        async function loadHomePage() {
            showLoading('loading');
            hideError('error');
            hideContent('content');

            try {
                // Get all articles
                const articlesResponse = await fetch(`${API_BASE}/api/articles?limit=50`);
                const articlesData = await articlesResponse.json();
                allArticles = articlesData.items || articlesData || [];
                
                if (allArticles.length === 0) {
                    showError('error', 'No articles found');
                    hideLoading('loading');
                    return;
                }

                // Sort articles by score
                allArticles.sort((a, b) => (b.composite_score || 0) - (a.composite_score || 0));

                // Display sections
                displayHomePage();
                hideLoading('loading');
                showContent('content');
            } catch (error) {
                console.error('Error loading articles:', error);
                showError('error', 'Failed to load articles');
                hideLoading('loading');
            }
        }

        // Display home page sections
        function displayHomePage() {
            const content = document.getElementById('content');
            content.innerHTML = '';

            const displayedIds = new Set();

            // Helper to filter out already displayed articles
            const getUniqueArticles = (filterFn, limit) => {
                return allArticles.filter(a => {
                    if (displayedIds.has(a.id)) return false;
                    if (!filterFn(a)) return false;
                    displayedIds.add(a.id);
                    return true;
                }).slice(0, limit);
            };

            // Top Story
            const topStory = allArticles[0];
            if (topStory) {
                displayedIds.add(topStory.id);
                content.innerHTML += `
                    <section>
                        <div class="flex items-center gap-2 mb-6">
                            <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                            </svg>
                            <h2 class="text-2xl font-bold">Top Story</h2>
                        </div>
                        ${createArticleCard(topStory, 'featured')}
                    </section>
                `;
            }

            // Quick Hits
            const quickHits = getUniqueArticles(a => a.composite_score > 70, 4);
            if (quickHits.length > 0) {
                content.innerHTML += `
                    <section>
                        <div class="flex items-center gap-2 mb-6">
                            <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            <h2 class="text-2xl font-bold">Quick Hits</h2>
                        </div>
                        <div class="grid gap-6 md:grid-cols-2">
                            ${quickHits.map(article => createArticleCard(article, 'quick')).join('')}
                        </div>
                    </section>
                `;
            }

            // Opportunities
            const opportunities = getUniqueArticles(a => 
                a.topics && (a.topics.includes('big_returns') || a.topics.includes('market_transformations') || (a.composite_score && a.composite_score > 25)), 3);
            if (opportunities.length > 0) {
                content.innerHTML += `
                    <section>
                        <div class="flex items-center gap-2 mb-6">
                            <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                            </svg>
                            <h2 class="text-2xl font-bold">Opportunities</h2>
                        </div>
                        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                            ${opportunities.map(article => createArticleCard(article, 'opportunity')).join('')}
                        </div>
                    </section>
                `;
            }

            // Practices
            const practices = getUniqueArticles(a => 
                a.topics && (a.topics.includes('material_breakthroughs') || a.source.toLowerCase().includes('green') || a.title.toLowerCase().includes('construction') || a.title.toLowerCase().includes('building')), 2);
            if (practices.length > 0) {
                content.innerHTML += `
                    <section>
                        <div class="flex items-center gap-2 mb-6">
                            <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                            </svg>
                            <h2 class="text-2xl font-bold">Practices</h2>
                        </div>
                        <div class="grid gap-6 md:grid-cols-2">
                            ${practices.map(article => createArticleCard(article, 'practice')).join('')}
                        </div>
                    </section>
                `;
            }

            // Systems
            const systems = getUniqueArticles(a => 
                a.topics && a.topics.includes('market_transformations'), 3);
            if (systems.length > 0) {
                content.innerHTML += `
                    <section>
                        <div class="flex items-center gap-2 mb-6">
                            <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                            </svg>
                            <h2 class="text-2xl font-bold">Systems</h2>
                        </div>
                        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                            ${systems.map(article => createArticleCard(article, 'system')).join('')}
                        </div>
                    </section>
                `;
            }

            // Vision
            const vision = getUniqueArticles(a => 
                a.topics && a.topics.includes('material_breakthroughs'), 2);
            if (vision.length > 0) {
                content.innerHTML += `
                    <section>
                        <div class="flex items-center gap-2 mb-6">
                            <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                            </svg>
                            <h2 class="text-2xl font-bold">Vision</h2>
                        </div>
                        <div class="grid gap-6 md:grid-cols-2">
                            ${vision.map(article => createArticleCard(article, 'vision')).join('')}
                        </div>
                    </section>
                `;
            }
        }

        // Create article card
        function createArticleCard(article, type = 'default') {
            const score = article.composite_score || 0;
            const topics = article.topics || [];
            const why = article.why1 || '';
            const summary = article.summary2 || article.summary_raw || '';
            
            return `
                <article 
                    class="group mb-8 bg-card rounded-xl overflow-hidden border border-border shadow-sm hover:shadow-md transition-all duration-300 animate-fade-in cursor-pointer"
                    onclick="window.open('${article.url}', '_blank', 'noopener,noreferrer')"
                >
                    <!-- Image Section -->
                    <div class="relative w-full aspect-[4/3] bg-muted overflow-hidden">
                        ${article.thumbnail_url ? `
                            <img
                                src="${article.thumbnail_url}"
                                alt="${article.title}"
                                loading="lazy"
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                            />
                        ` : ''}
                        <div class="w-full h-full flex items-center justify-center ${article.thumbnail_url ? 'hidden' : ''}">
                            <svg class="w-20 h-20 text-muted-foreground opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                            </svg>
                        </div>
                        
                        <!-- Source badge overlay -->
                        <div class="absolute top-4 left-4">
                            <span class="px-3 py-1.5 bg-background/90 backdrop-blur-sm rounded-full text-xs font-medium text-foreground border border-border shadow-sm">
                                ${article.source || 'News'}
                            </span>
                        </div>
                        
                        <!-- Score badge -->
                        <div class="absolute top-4 right-4">
                            <span class="px-3 py-1.5 bg-accent/90 backdrop-blur-sm rounded-full text-xs font-medium text-accent-foreground border border-border shadow-sm">
                                ${Math.round(score)}
                            </span>
                        </div>
                    </div>

                    <!-- Content Section -->
                    <div class="p-6">
                        <!-- Title -->
                        <h2 class="text-xl font-bold text-foreground mb-3 leading-tight group-hover:text-primary transition-colors">
                            ${article.title}
                        </h2>
                        
                        <!-- Synopsis -->
                        <p class="text-foreground/90 mb-4 leading-relaxed text-[15px]">
                            ${summary.substring(0, 200)}${summary.length > 200 ? '...' : ''}
                        </p>
                        
                        <!-- Topics -->
                        ${topics.length > 0 ? `
                            <div class="mb-4 flex flex-wrap gap-2">
                                ${topics.map(topic => `
                                    <span class="px-2 py-1 bg-secondary text-secondary-foreground rounded-md text-xs font-medium">
                                        ${topic.replace(/_/g, ' ')}
                                    </span>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Why it matters section -->
                        ${why ? `
                            <div class="mb-4 p-4 bg-muted/50 rounded-lg border-l-4 border-primary">
                                <p class="text-sm font-semibold text-foreground mb-1">Why it matters</p>
                                <p class="text-sm text-muted-foreground leading-relaxed">
                                    ${why.substring(0, 150)}${why.length > 150 ? '...' : ''}
                                </p>
                            </div>
                        ` : ''}
                        
                        <!-- Read more link -->
                        <a
                            href="${article.url}"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-2 text-primary font-medium hover:gap-3 transition-all group/link"
                        >
                            <span>Read full story</span>
                            <svg class="h-4 w-4 group-hover/link:translate-x-0.5 group-hover/link:-translate-y-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </a>
                    </div>
                </article>
            `;
        }

        // Load theme page
        async function loadThemePage(themeName) {
            document.getElementById('theme-title').textContent = getThemeTitle(themeName);
            document.getElementById('theme-description').textContent = getThemeDescription(themeName);
            
            showLoading('theme-loading');
            hideError('theme-error');
            hideContent('articles-grid');

            try {
                let themeArticles = [];
                
                // Filter articles by theme - show all articles for now since we only have 2 articles
                if (themeName === 'opportunities') {
                    // Show articles with opportunity-related topics or high scores
                    themeArticles = allArticles.filter(article => 
                        article.topics && (
                            article.topics.includes('big_returns') || 
                            article.topics.includes('market_transformations') ||
                            (article.composite_score && article.composite_score > 25)
                        )
                    );
                } else if (themeName === 'practices') {
                    // Show articles with material/construction topics
                    themeArticles = allArticles.filter(article => 
                        article.topics && (
                            article.topics.includes('material_breakthroughs') ||
                            article.source.toLowerCase().includes('green') ||
                            article.title.toLowerCase().includes('construction') ||
                            article.title.toLowerCase().includes('building')
                        )
                    );
                } else if (themeName === 'systems') {
                    // Show articles with market/system topics
                    themeArticles = allArticles.filter(article => 
                        article.topics && (
                            article.topics.includes('market_transformations') ||
                            article.title.toLowerCase().includes('policy') ||
                            article.title.toLowerCase().includes('regulation') ||
                            article.title.toLowerCase().includes('code')
                        )
                    );
                } else if (themeName === 'vision') {
                    // Show articles with future/innovation topics
                    themeArticles = allArticles.filter(article => 
                        article.topics && (
                            article.topics.includes('material_breakthroughs') ||
                            article.title.toLowerCase().includes('future') ||
                            article.title.toLowerCase().includes('innovation') ||
                            article.title.toLowerCase().includes('smart')
                        )
                    );
                }
                
                // If no articles match the specific filters, show all articles for that theme
                if (themeArticles.length === 0) {
                    themeArticles = allArticles;
                }

                if (themeArticles.length > 0) {
                    const articlesGrid = document.getElementById('articles-grid');
                    articlesGrid.innerHTML = themeArticles.map(article => createArticleCard(article, themeName)).join('');
                    hideLoading('theme-loading');
                    showContent('articles-grid');
                } else {
                    hideLoading('theme-loading');
                    showError('theme-error');
                }
            } catch (error) {
                console.error('Error loading theme:', error);
                hideLoading('theme-loading');
                showError('theme-error');
            }
        }

        // Theme helpers
        function getThemeTitle(themeName) {
            const titles = {
                opportunities: 'Opportunities',
                practices: 'Practices',
                systems: 'Systems',
                vision: 'Vision'
            };
            return titles[themeName] || themeName;
        }

        function getThemeDescription(themeName) {
            const descriptions = {
                opportunities: 'High-return projects and market transformations',
                practices: 'Material breakthroughs and construction innovations',
                systems: 'Market transformations and regulatory changes',
                vision: 'Future-focused material science and technology'
            };
            return descriptions[themeName] || '';
        }

        // Refresh articles
        async function refreshArticles() {
            const refreshIcon = document.getElementById('refresh-icon');
            refreshIcon.classList.add('animate-spin');
            
            try {
                await loadHomePage();
            } finally {
                refreshIcon.classList.remove('animate-spin');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadHomePage();
        });
    </script>
</body>
</html>
